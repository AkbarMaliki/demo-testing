<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Berita Populer & Carousel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #fff;
    }
    .carousel-section {
      height: 100%;
      min-height: 320px;
      padding-bottom: 18px;
    }
    .populer-section {
      background: #fff;
      box-shadow: 0 0 1px #d7d9dd, 0px 2px 9px #f1f2f6;
      border-radius: 10px;
      padding: 18px 23px 12px 23px;
      box-sizing: border-box;
      min-width: 0;
      min-height: 340px;
      display: flex;
      flex-direction: column;
      height: fit-content;
    }
    .populer-header {
      background: #079b62;
      color: #fff;
      font-weight: 600;
      font-size: 20px;
      padding: 6px 30px 7px 18px;
      border-radius: 2.5px;
      letter-spacing: 0.5px;
      display: inline-block;
      margin-bottom: 25px;
    }
    .populer-item {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 16px;
      border-bottom: 1px solid #e8eaec;
      padding-bottom: 17px;
      margin-bottom: 23px;
      transition: background 0.18s;
    }
    .populer-item:last-child {
      border-bottom: 0;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .populer-item-img {
      width: 92px;
      height: 66px;
      object-fit: cover;
      border-radius: 4.5px;
      background: #f1f5f7;
      flex-shrink: 0;
    }
    .populer-info {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      width: 0;
      flex-grow: 1;
    }
    .populer-date {
      font-size: 13px;
      font-style: italic;
      color: #3aa283;
      font-weight: 500;
      margin-bottom: 3px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      white-space: nowrap;
    }
    .populer-title {
      font-size: 16px;
      font-weight: 500;
      color: #222;
      margin-bottom: 2px;
      line-height: 1.23;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      max-width: 210px;
    }
    .populer-content-preview {
      font-size: 14px;
      color: #45505a;
      font-family: inherit;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-top: 1px;
      max-width: 215px;
    }
    /* Carousel Styles */
    .swiper {
      width: 100%;
      height: 450px;
    }
    .swiper-slide {
      font-size: 18px;
      display: flex;
      flex-direction: column;
      padding: 0;
      position: relative;
      overflow: hidden;
      border-radius: 11px;
      height: 450px;
    }
    .swiper-slide .image-container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .swiper-slide img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 11px;
      background: #eee;
    }
    .slide-title {
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      box-sizing: border-box;
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-size: 21px;
      padding: 10px 14px;
      text-align: left;
      z-index: 2;
      opacity: 1;
      pointer-events: auto;
      font-weight: 500;
      border-radius: 0 0 11px 11px;
    }
    .swiper-button-next, .swiper-button-prev {
      color: #fff !important;
      fill: #fff !important;
      stroke: #fff !important;
      filter: drop-shadow(0 0 2px #0008);
    }
    .swiper-button-next:hover, .swiper-button-prev:hover {
      filter: drop-shadow(0 0 2px #000a);
    }
    @media (max-width: 950px) {
      .carousel-section, .populer-section {
        width: 100%;
        max-width: 100vw;
        min-width: 0;
      }
      .carousel-section {
        height: 44vw;
        min-height: 310px;
        max-height: 440px;
      }
      .swiper, .swiper-slide {
        height: 44vw;
        min-height: 310px;
        max-height: 440px;
      }
    }
    @media (max-width: 600px) {
      .carousel-section, .swiper, .swiper-slide {
        height: 240px !important;
        min-height: 180px !important;
        max-height: 270px !important;
      }
      .populer-section {
        padding: 11px 10px 8px 10px;
        min-width: 0;
        width: 99vw;
      }
      .populer-title {
        max-width: 90vw;
      }
      .populer-content-preview {
        max-width: 90vw;
      }
    }
  </style>
</head>

<body>
  <link rel="stylesheet" href="https://web-raker-deploy.vercel.app/all.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <div id="app">
    <div v-if="datanya" class="container-fluid py-3">
      <div class="row gx-4 gy-3 align-items-start">
        <div class="col-md-5">
            <div class="populer-section">
              <div class="populer-header">Berita Populer</div>
              <div v-for="(item, idx) in datanya" :key="idx+'populer'" class="populer-item">
                <img class="populer-item-img" :src="item.content_image_url" :alt="item.name">
                <div class="populer-info">
                  <span class="populer-date">{{ (item.published_date || item.post_date) ? (item.published_date || item.post_date) : '' }}</span>
                  <span class="populer-title" :title="item.name">{{ item.name }}</span>
                  <span class="" v-html="getPreviewHtml(item.content)"></span>
                  <a
                    v-if="item.website_url"
                    :href="item.website_url"
                    target="_blank"
                    rel="noopener"
                    class="btn btn-success btn-sm mt-2"
                    style="display:inline-block; font-size:13px; padding:2px 14px; text-decoration:none;width:150px;"
                  >
                    Baca Selengkapnya
                  </a>
                  <hr style="margin:10px 0;" />
                </div>
              </div>
            </div>
          </div>
        <!-- Carousel Side (Left) -->
        <div class="col-md-7 mb-3 mb-md-0">
          <div class="carousel-section">
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                  <div class="swiper-slide" v-for="(item, index) in datanya" :key="index+'carousel'">
                    <div class="image-container" tabindex="0">
                      <a v-if="item.website_url" :href="item.website_url" target="_blank" rel="noopener">
                        <img :src="item.content_image_url" :alt="item.name">
                      </a>
                      <img v-else :src="item.content_image_url" :alt="item.name">
                      <div class="slide-title">
                        <a v-if="item.website_url" :href="item.website_url" target="_blank" rel="noopener" style="color: inherit; text-decoration: none;">
                          {{ item.name }}
                        </a>
                        <span v-else>{{ item.name }}</span>
                      </div>
                    </div>
                  </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </div>
  <script>
    const { createApp } = Vue
    createApp({
      data() {
        return {
          datanya: null
        }
      },
      methods: {
        async getData() {
          try {
            const response = await fetch('/api/v1/berita/populer');
            if(!response.ok) {
              throw new Error('Network response was not ok');
            }
            const json = await response.json();
            this.datanya = json.data;
            setTimeout(() => {
                  var swiper = new Swiper(".mySwiper", {
                      navigation: {
                          nextEl: ".swiper-button-next",
                          prevEl: ".swiper-button-prev",
                      },
                      autoplay: {
                          delay: 1500,
                      },
                      speed: 500,
                      loop: true,
                  });
              }, 500);
          } catch (error) {
            console.error('Failed to fetch data:', error);
            this.datanya = [];
          }
        },
        getPreviewHtml(content) {
          if (!content) return "";
          let cleaned = content
            .replace(/<img\b[^>]*>/gi, "")
            .replace(/<p\b([^>]*)>/gi, "<span$1> ")
            .replace(/<\/p>/gi, " </span>")
            .replace(/\n+/g, " ")
            .replace(/\s{2,}/g, " ")
            .replace(/>\s+</g, "><")
            .trim();

          // Ambil hanya 100 karakter pertama dari hasil cleaned
          let textOnly = cleaned.replace(/<\/?[^>]+(>|$)/g, ""); // remove all tags for counting
          let preview = textOnly.slice(0,100) + " ...";
          return preview;
        }
      },
      mounted() {
        this.getData();
      },
    }).mount('#app')
  </script>
</body>

</html>
